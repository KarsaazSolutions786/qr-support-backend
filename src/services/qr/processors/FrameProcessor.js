/**
 * FrameProcessor - Handles advanced shapes and frames around QR codes
 *
 * Sort Order: 110 (runs after colors/modules, before logo)
 *
 * This comprehensive implementation includes all 60+ Laravel frame shapes
 * for feature parity between Node.js and Laravel backends.
 *
 * Frame Categories:
 * - Basic frames: scan-me, four-corners-text-bottom, rounded-frame, banner-bottom, ticket
 * - Themed frames: healthcare, wifi-connect, review-collector, social-follow
 * - Laravel shapes: apple, bag, bakery, barn, book, boot, etc. (60+ shapes)
 *
 * Features:
 * - Custom frame colors
 * - Custom text colors
 * - Drop shadow support
 * - Custom text content
 * - SVG path-based shapes from Laravel
 */
const BaseProcessor = require('./BaseProcessor');

class FrameProcessor extends BaseProcessor {
    constructor() {
        super('FrameProcessor', 110);

        // Basic frame generators (text-based frames)
        this.basicFrames = {
            'none': null,
            'scan-me': this.createScanMeFrame.bind(this),
            'four-corners-text-bottom': this.createFourCornersFrame.bind(this),
            'rounded-frame': this.createRoundedFrame.bind(this),
            'banner-bottom': this.createBannerBottomFrame.bind(this),
            'healthcare': this.createHealthcareFrame.bind(this),
            'wifi-connect': this.createWifiFrame.bind(this),
            'review-collector': this.createReviewFrame.bind(this),
            'social-follow': this.createSocialFrame.bind(this),
            'ticket': this.createTicketFrame.bind(this),
        };

        // Laravel shape definitions - comprehensive collection of 60+ shapes
        this.laravelShapes = this.initializeLaravelShapes();

        // Combined frames object for lookup
        this.frames = { ...this.basicFrames };
        Object.keys(this.laravelShapes).forEach(key => {
            this.frames[key] = (frameInfo, size, qrSize) =>
                this.createLaravelShapeFrame(key, frameInfo, size, qrSize);
        });
    }

    /**
     * Initialize all Laravel shape definitions
     * Each shape has: shapeId, symbolPath, symbolViewBox, framePath (optional), frameViewBox, transform
     */
    initializeLaravelShapes() {
        return {
            // Apple shape with frame
            'apple': {
                shapeId: 'apple',
                symbolViewBox: '0 0 700 700',
                transform: 'translate(-9%, 10%) scale(2.8)',
                symbolPath: 'm 447.74868,161.30591 c 7.73458,-21.92213 25.8058,-49.29619 44.21413,-66.97499 40.67688,-39.064847 91.63168,-56.360368 152.58209,-51.790732 l 18.57797,1.392846 -1.13001,5.019194 c -0.62151,2.760557 -5.13077,13.114907 -10.02059,23.009668 -7.57612,15.330609 -11.56221,20.650339 -26.96054,35.980944 -34.91928,34.7657 -81.61115,53.1818 -148.63499,58.6243 -34.44356,2.7969 -31.65213,3.30991 -28.62806,-5.26123 z m -78.3762,728.58576 C 249.56925,878.35493 169.1632,805.61939 136.24899,679.00754 125.68868,638.38492 122.36951,615.16657 122.7046,584.26132 c 0.52852,-48.7454 7.4711,-90.09669 23.05841,-137.34007 17.84809,-54.09558 28.75127,-74.23654 53.9385,-99.63821 12.67772,-12.78566 18.25938,-16.82477 33.22778,-24.04491 25.91407,-12.49988 43.33959,-16.74669 73.25952,-17.85421 30.14518,-1.11585 40.49145,0.51537 80.83268,12.74435 37.8477,11.47309 45.38135,13.20922 65.58096,15.11319 26.9385,2.53915 49.86056,-0.53804 91.04081,-12.22185 44.69713,-12.68163 63.76915,-15.40569 86.64582,-12.37565 28.04029,3.71398 51.15345,12.89505 77.93746,30.95852 45.35445,30.58762 82.42042,92.89225 98.79891,166.07228 4.07978,18.22875 4.43457,24.05723 4.3775,71.91414 -0.054,45.28503 -0.6096,55.13347 -4.2596,75.50566 C 788.52974,756.98468 722.30933,839.1402 628.8032,874.35 c -17.50924,6.59312 -47.23182,13.31716 -69.26482,15.66957 l -18.9974,2.02829 -20.17631,-6.68053 c -39.45413,-13.06356 -73.17237,-12.47387 -113.79814,1.9902 -7.09256,2.52517 -14.76219,4.47511 -17.04361,4.33319 -2.28142,-0.14203 -11.34913,-0.95151 -20.15044,-1.79905 z M 752.37101,589.42474 c 5.85155,-24.34494 7.50887,-40.80745 6.4343,-63.91353 -2.18175,-46.91348 -18.39412,-85.86474 -51.1914,-122.99057 -11.47108,-12.98504 -35.96316,-33.4907 -48.24861,-40.39552 l -7.46027,-4.19291 -7.03473,13.38712 c -3.86911,7.36291 -6.7423,13.58149 -6.3849,13.81907 0.35743,0.23758 6.51507,4.18345 13.68365,8.76862 39.08351,24.99855 67.48949,68.9855 75.12803,116.33655 3.07281,19.04829 1.32501,52.97564 -3.6143,70.15868 -2.09148,7.2759 -3.51301,13.51857 -3.15898,13.87261 1.10318,1.10319 22.60581,7.57785 25.77079,7.75984 2.18487,0.12555 3.84172,-3.31269 6.07642,-12.60996 z',
                hasFrame: true,
                framePath: 'm 489.40682,269.51913 -9.70345,18.97457 h 0.005 c 27.17448,14.5661 48.24667,38.36627 59.41312,67.10664 11.16112,28.74038 11.68167,60.52725 1.46288,89.61679 l 20.36455,6.28861 C 599.00901,327.61932 490.5829,270.04927 489.40616,269.5162 Z m 72.28406,-18.44416 C 519.57582,213.1205 471.28249,200.32953 422.24021,213.97341 l -37.63197,10.66137 c -7.67325,2.0875 -15.52828,3.44615 -23.45767,4.05012 -1.49405,-28.27262 -9.48488,-55.81625 -23.34839,-80.49598 173.78028,-3.40978 183.05567,-122.3925 183.05567,-123.667866 v -9.490083 l -9.38081,-1.598138 C 393.13454,-7.8899015 334.49835,60.87858 314.02853,113.43512 295.2312,90.21733 273.22615,69.790151 248.67569,52.771944 l -11.411,17.376696 c 89.98193,63.9682 101.60016,132.52212 102.56368,158.00146 -7.91274,-0.82251 -15.73218,-2.38948 -23.3484,-4.69034 l -31.9841,-9.80765 c -46.02379,-14.8886 -96.31212,-8.14702 -136.78534,18.34021 -18.97456,12.68636 -34.33226,33.2648 -48.080088,64.92639 -20.479159,47.44576 -30.791367,98.65363 -30.282288,150.32528 l 0.530997,7.14232 C 86.084424,602.15285 165.08648,685.95119 292.06203,690.53558 h 0.005 c 7.07463,0.1718 14.097,-1.20773 20.57778,-4.05012 23.80549,-10.3074 50.81873,-10.3074 74.62956,0 6.02301,2.62376 12.51459,4.00321 19.07853,4.05012 h 1.59814 C 534.92957,685.94933 630.66732,581.89626 630.66732,448.52255 v -36.46054 c 0.32275,-54.47825 -30.7034,-126.6557 -68.97639,-160.98664 z M 469.36212,30.704514 c 9.66706,0.02603 19.31839,0.70277 28.8923,2.03019 -6.07512,25.695228 -34.5455,93.390906 -165.35781,94.031926 9.22462,-28.663088 27.53298,-53.541386 52.15142,-70.871439 24.62375,-17.330052 54.21837,-26.174989 84.31275,-25.190144 z M 609.6657,448.52348 c 0,121.64753 -86.8888,216.53237 -202.56597,220.69031 v -0.005 c -3.92511,0.0365 -7.81385,-0.76524 -11.411,-2.34257 -29.28278,-12.50418 -62.40097,-12.50418 -91.68375,0 -3.58675,1.60853 -7.48069,2.41027 -11.411,2.34257 C 175.31895,665.04905 106.02006,589.99317 90.880921,452.46286 v -6.07512 c -0.426874,-48.44924 9.271389,-96.45738 28.464519,-140.94326 7.98043,-22.00507 21.98373,-41.32347 40.40658,-55.75895 35.12254,-22.75936 78.61692,-28.51249 118.45178,-15.66955 l 31.9841,9.80766 c 26.06971,8.02721 53.89455,8.39689 80.16816,1.06718 l 37.63195,-10.66137 c 52.66716,-14.6074 94.03193,9.59416 119.51392,31.9841 33.69126,30.38623 62.15711,96.80654 62.15711,145.20782 z',
            },

            // Bag shape with frame
            'bag': {
                shapeId: 'bag',
                symbolViewBox: '0 0 700 700',
                transform: 'scale(1.3) translate(-12%, 8%)',
                symbolPath: 'm 168.29712,252.93629 c -3.78728,-2.12989 -7.07667,-7.66421 -7.06978,-11.89476 0.008,-5.10791 4.39036,-10.54979 9.80039,-12.17067 4.25883,-1.27598 5.65306,-1.19582 9.27947,0.53349 8.26253,3.94014 10.25364,15.47877 3.72879,21.60856 -3.73424,3.50812 -11.28102,4.43038 -15.73887,1.92338 z m 222.98564,-2.31874 c -6.93207,-6.93208 -5.37365,-16.56326 3.41553,-21.10832 7.06715,-3.65458 16.7741,1.22587 18.80656,9.45552 1.13968,4.61474 -2.18497,11.62269 -6.59613,13.90379 -6.12101,3.1653 -10.89779,2.47719 -15.62596,-2.25099 z m 90.35442,421.07024 c 0,-0.93615 70.04645,-61.49404 71.12927,-61.49404 0.59161,0 15.28222,12.42988 32.6458,27.62194 17.36358,15.19206 33.29702,29.11868 35.40766,30.94806 l 3.83751,3.32612 -71.51013,0.0499 c -39.33055,0.0274 -71.51011,-0.17595 -71.51011,-0.45197 z M 601.63914,622.51053 563.88917,589.6737 V 375.58224 161.49078 h 14.65923 c 8.98342,0 14.97003,0.50284 15.46191,1.29871 0.87819,1.42096 46.16716,488.07843 45.67921,490.85099 -0.17162,0.97515 -16.48381,-12.37025 -38.05038,-31.12995 z m -135.9613,29.23703 c 0,-1.80015 11.04878,-112.53547 24.55283,-246.07848 13.50406,-133.54301 24.55283,-243.11437 24.55283,-243.49189 0,-0.37753 6.07682,-0.68641 13.50406,-0.68641 h 13.50406 l -0.0818,213.91653 -0.0818,213.91653 -37.97513,32.84837 c -33.74224,29.18694 -37.97512,32.48354 -37.97512,29.57535 z M 50.752269,668.81364 c 0.05757,-7.16177 46.406821,-504.73589 47.12459,-505.89726 0.629813,-1.01906 9.384181,-1.4256 30.698711,-1.4256 h 29.81763 l 0.8022,20.563 c 0.44122,11.30964 1.14227,22.0822 1.55789,23.939 0.59391,2.65327 0.3098,3.37601 -1.32711,3.37601 -1.14553,0 -5.31335,3.23057 -9.26182,7.17905 -5.76684,5.76683 -7.58812,8.58624 -9.25868,14.33273 -5.28236,18.17073 3.86899,37.06412 21.06993,43.49982 27.65057,10.3454 54.89766,-14.86161 46.66727,-43.17315 -2.51298,-8.64437 -10.8123,-18.17356 -19.08373,-21.91179 -7.07339,-3.19676 -7.12072,-3.36979 -8.29334,-30.31078 l -0.76143,-17.49389 h 107.17445 107.17445 l -0.77967,16.26624 c -0.42882,8.94644 -1.13094,19.06126 -1.56026,22.47739 -0.75178,5.98198 -0.99751,6.31065 -6.66128,8.90895 -13.15862,6.03663 -20.17623,17.21685 -20.17623,32.14412 0,14.72821 7.29988,26.40909 20.2053,32.33145 8.38318,3.84708 21.98517,3.54093 30.07721,-0.67698 21.5617,-11.23882 26.32139,-39.26022 9.58641,-56.43741 -2.42568,-2.48977 -6.04681,-5.20471 -8.04695,-6.0332 -3.32781,-1.37842 -3.57119,-1.88015 -2.8659,-5.9081 0.42392,-2.42097 1.11913,-13.10266 1.54494,-23.73711 l 0.77419,-19.33535 h 37.86746 c 29.44679,0 37.87944,0.34124 37.92134,1.53455 0.0297,0.844 -11.43345,115.47422 -25.47356,254.73383 l -25.52745,253.19925 -195.50191,9.2e-4 c -185.381129,0.002 -195.501025,-0.10884 -195.484651,-2.146 z',
                hasFrame: true,
                framePath: 'm 616.2633,162.80115 c -0.53001,-6.10237 -3.30898,-11.78925 -7.79267,-15.96306 -4.48846,-4.16856 -10.36163,-6.5225 -16.48747,-6.60844 H 487.69946 C 481.60186,65.358861 427.37255,8.0292334 360.52302,8.0292334 341.504,8.1581578 322.80647,12.971317 306.08431,22.038933 c -6.1119,-1.055256 -12.29959,-1.62821 -18.50317,-1.709376 -62.5712,0 -114.7705,51.875367 -125.67291,119.898383 H 99.977557 c -6.197835,-0.0191 -12.180775,2.2872 -16.755166,6.46529 -4.579159,4.18287 -7.415448,9.93184 -7.950239,16.10609 L 28.954946,671.17504 c -0.381994,5.52455 1.53751,10.95839 5.309775,15.01205 3.767376,4.0539 9.048425,6.36493 14.587882,6.37936 H 643.11276 c 5.53885,-0.0143 10.82002,-2.32534 14.58789,-6.37936 3.77214,-4.0539 5.69164,-9.48775 5.30977,-15.01205 z m -74.23148,426.86741 -77.8644,67.59885 50.16526,-496.28638 h 27.70403 z m 10.69582,18.50317 73.26703,64.17496 H 479.13791 Z m 42.78331,-443.44289 45.56178,493.08375 -78.3998,-68.13303 V 160.99081 h 29.30901 c 1.95776,0.20054 3.49051,1.781 3.63854,3.74353 z M 360.20275,28.78794 c 55.40317,0 100.54078,48.131216 106.95828,111.45174 h -53.47914 v -0.005 C 407.2787,93.822242 378.7157,53.417684 337.10221,31.886678 c 7.63988,-2.043697 15.51323,-3.084554 23.42081,-3.098978 z m -50.27038,15.079282 c 41.07442,10.695827 73.48094,48.236341 82.35787,96.262438 H 254.30795 c 2.82199,-38.91081 23.31568,-74.384282 55.6183,-96.262438 z m -30.91278,-2.244168 h 0.005 c -26.77268,26.190713 -43.05601,61.257136 -45.78192,98.611856 h -50.37551 c 9.84114,-53.369124 48.6654,-94.123275 96.15732,-98.611856 z M 96.334864,164.72897 c 0.148018,-1.96254 1.680773,-3.54295 3.638537,-3.74354 h 59.576369 v 5.66781 5.66781 c -0.38677,12.27636 0.40109,24.56251 2.35406,36.69096 -10.38547,4.11123 -18.16824,12.95479 -20.93326,23.77408 -2.76943,10.82002 -0.18622,22.30844 6.94752,30.90299 7.12892,8.5948 17.94943,13.25549 29.09387,12.5294 11.14469,-0.72101 21.26697,-6.74216 27.22608,-16.18676 5.9591,-9.44484 7.03345,-21.17652 2.88885,-31.54841 -4.14461,-10.3719 -13.00735,-18.12546 -23.83153,-20.86603 -2.22986,-11.58878 -3.12758,-23.39269 -2.67396,-35.18622 v -5.7777 -5.66781 h 213.91655 v 5.66781 5.66781 c 0.45361,11.83227 -0.43929,23.67384 -2.67396,35.29623 -10.79129,2.74082 -19.61553,10.47617 -23.74107,20.81836 -4.12076,10.33767 -3.04641,22.0224 2.89839,31.43351 5.94003,9.41135 16.02907,15.4081 27.13562,16.1293 11.10642,0.72579 21.88794,-3.9154 28.99852,-12.48172 7.10986,-8.56143 9.69311,-20.01159 6.94276,-30.79298 -2.75036,-10.78653 -10.5,-19.60087 -20.84281,-23.71173 1.953,-12.16171 2.74082,-24.4855 2.34929,-36.79609 v -5.56281 -5.66781 h 78.29468 l -51.66023,510.8327 H 49.708392 Z m 78.509816,62.5712 c 5.72037,0 10.87246,3.45224 13.05502,8.74283 2.1773,5.28581 0.95021,11.36911 -3.10851,15.39954 -4.06344,4.0253 -10.1515,5.20942 -15.42277,2.98909 -5.27152,-2.22033 -8.68563,-7.40115 -8.6426,-13.12103 0,-3.73401 1.48984,-7.31521 4.1446,-9.94137 2.65012,-2.63093 6.24087,-4.09693 9.97487,-4.06821 z m 225.46804,0 c 5.72037,0 10.87723,3.45224 13.05502,8.74283 2.1773,5.28581 0.9502,11.36911 -3.10851,15.39954 -4.05867,4.0253 -10.15151,5.20942 -15.42278,2.98909 -5.27151,-2.22033 -8.68562,-7.40115 -8.64259,-13.12103 0.0621,-7.75454 6.36493,-14.0097 14.11971,-14.0097 z',
            },

            // Bakery shape
            'bakery': {
                shapeId: 'bakery',
                symbolViewBox: '0 0 700 700',
                transform: 'translate(-16.5%, -4%) scale(2.2)',
                hasFrame: true,
                symbolPath: 'm 486.17275,785.36585 c 0.12811,-6.70568 41.88316,-247.10938 43.09334,-248.10887 1.39478,-1.15193 225.33755,-12.52741 226.36639,-11.49858 0.81129,0.8113 -33.62328,200.88346 -34.67906,201.49273 -1.27883,0.73798 -231.78181,62.80148 -233.24384,62.80148 -0.8945,0 -1.58608,-2.10904 -1.53683,-4.68676 z m 205.61471,-283.86938 -25.95525,-0.87364 9.13442,-17.9824 c 22.19773,-43.69933 17.4661,-109.79152 -13.03378,-182.05788 -18.21374,-43.15563 -53.86219,-95.03122 -79.29489,-115.3899 -6.16503,-4.93505 -10.78702,-9.39493 -10.27111,-9.91085 2.22507,-2.22507 157.97685,38.9982 176.39346,46.68657 29.85,12.46145 58.01345,32.14805 81.10192,56.69123 51.07029,54.28805 69.71157,137.72866 41.71936,186.74116 -9.7361,17.04725 -25.08206,24.96912 -63.20267,32.62633 -27.12295,5.44815 -43.40805,5.93274 -116.59146,3.46938 z m -411.92137,256.79621 -172.74031,-33.94112 0.80855,-9.33025 c 1.86659,-21.53946 27.45455,-261.87946 28.81286,-270.63051 1.44305,-9.29705 0.92695,-9.98062 -19.13773,-25.34893 C 69.11404,381.89737 44.537424,336.22954 51.419942,296.04969 66.400432,208.59419 195.73149,137.1178 341.46341,135.7536 c 49.52471,-0.4636 78.52494,3.99073 121.34223,18.6377 58.27045,19.9332 84.87664,35.97662 119.89254,72.29473 45.8204,47.52444 75.59676,110.2652 81.60489,171.94699 4.44323,45.61581 -15.84474,88.25524 -48.69121,102.33489 -14.65663,6.28255 -47.72122,10.55768 -81.65513,10.55768 h -25.916 l -2.72429,15.39933 c -1.49837,8.46963 -12.15835,71.74079 -23.68883,140.60258 -16.93824,101.15769 -21.73818,125.15553 -24.99287,124.95477 -2.21558,-0.13666 -81.76147,-15.52196 -176.76865,-34.18959 z',
                framePath: 'm 262.13086,84.154297 c -8.31167,0.134787 -16.55796,0.552544 -24.85549,1.261245 -4.12386,0.359154 -8.39998,0.791651 -12.52088,1.299355 -24.58146,2.976657 -48.9267,8.480639 -72.41955,16.434423 -18.37961,6.24651 -36.31831,14.09918 -53.227518,23.71591 -8.464051,4.83322 -16.905485,10.27648 -24.817954,16.19781 -6.306062,4.71026 -12.38087,9.78462 -18.023467,15.20554 -11.506442,11.05123 -21.636904,23.76802 -28.496822,38.23867 -6.0528,12.72524 -9.327957,26.88651 -8.623946,41.0065 0.149485,3.34205 0.528041,6.6716 1.079376,9.97063 0.09639,0.52546 0.261566,1.47479 0.373843,2.02411 2.2034,11.33716 6.7384,22.13528 12.680845,32.00713 6.225446,10.33731 14.031574,19.86029 22.549728,28.47661 8.262411,8.383 17.3158,15.95091 26.697715,23.03999 1.185836,0.77564 1.772224,2.23133 1.521844,3.61581 -0.916093,8.14661 -1.70324,16.30953 -2.569257,24.46247 -6.733995,64.887 -13.467989,129.77399 -20.201983,194.66098 99.212886,19.84375 198.425786,39.6875 297.638676,59.53125 0.48831,-0.97459 0.97594,-1.94953 1.46484,-2.92382 63.28332,-17.57901 126.56639,-35.15893 189.84961,-52.73829 2.26237,-2.82747 4.52474,-5.65494 6.78711,-8.48242 9.24907,-53.35084 18.49515,-106.70221 27.74609,-160.05273 11.25091,-0.96416 22.51421,-1.80202 33.7531,-2.89416 6.06378,-0.72829 12.158,-2.11876 17.83675,-4.17029 1.49622,-0.53715 3.22032,-1.22754 4.68746,-1.88121 3.40483,-1.50858 6.88468,-3.40378 10.03352,-5.55726 9.06127,-6.11039 16.31486,-14.74319 21.09825,-24.54623 6.64708,-13.4614 9.01024,-28.67628 8.74723,-43.65662 -0.3805,-18.27421 -4.57359,-36.33707 -11.18495,-53.33004 -2.19748,-5.63673 -4.7447,-11.29673 -7.51714,-16.73892 -13.70577,-26.97015 -33.84706,-50.91389 -58.37991,-68.78248 -9.78272,-7.14146 -20.40248,-13.39306 -31.47874,-18.46945 -1.54085,-0.70155 -2.92547,-1.34428 -4.48762,-1.92291 -68.58637,-16.80271 -137.17587,-33.59429 -205.76029,-50.403947 -12.66081,-4.215248 -25.63925,-7.45781 -38.77344,-9.804687 -5.87353,-1.04198 -11.93368,-1.939528 -17.86974,-2.63632 -8.0419,-0.944515 -16.0784,-1.561365 -24.18796,-1.910422 -6.30881,-0.250456 -12.7802,-0.347855 -19.14933,-0.246227 z',
            },

            // Barn shape
            'barn': {
                shapeId: 'barn',
                symbolViewBox: '0 0 700 700',
                transform: 'translate(24%, 14%) scale(1.8)',
                hasFrame: true,
                symbolPath: 'm 682.33677,287.62039 c -59.69444,-51.16109 -108.89042,-93.34401 -109.3244,-93.73984 -0.43398,-0.39582 14.18428,-0.71967 32.48503,-0.71967 h 33.27408 l 107.6513,92.03712 c 59.20821,50.62043 108.46086,92.80335 109.45034,93.73984 1.06865,1.01143 -11.76094,1.70271 -31.60099,1.70271 h -33.40001 z',
                framePath: 'M 303.40205,261.40463 H 167.6477 c -4.64929,0 -8.42297,3.77354 -8.42297,8.42884 v 41.20376 h 16.85136 v -33.19714 h 51.40124 v 32.94585 h 16.85136 v -32.94585 h 51.484 v 32.94585 h 16.43456 v -41.20376 c -0.0647,-2.26881 -1.04038,-4.40837 -2.70383,-5.94831 -1.66934,-1.53993 -3.87932,-2.33938 -6.14227,-2.22773 z M 687.3916,555.23135 h -52.75399 l -2.51076,-254.51976 -13.58222,0.50216 v 254.0176 H 387.75065 v -278.0723 l 27.55443,23.59402 c 1.50472,1.28724 3.41497,2.00428 5.38991,2.02204 h 246.89449 c 3.4091,-0.0764 6.43614,-2.20412 7.66474,-5.38991 1.1403,-3.23274 0.20573,-6.83008 -2.35699,-9.10476 L 487.7715,129.77321 c -1.50472,-1.28136 -3.41496,-1.99842 -5.39577,-2.02204 H 235.57152 c -1.98081,0.0235 -3.88519,0.74061 -5.38991,2.02204 L 44.800085,288.44596 55.503611,300.91873 83.058048,277.32472 v 278.0723 h -70.451 c -4.6553034,0 -8.4288407,3.76766 -8.4288407,8.42297 0,4.6553 3.7735373,8.42884 8.4288407,8.42884 H 687.39882 c 4.64929,0 8.42297,-3.77354 8.42297,-8.42884 0,-4.65531 -3.77353,-8.42297 -8.42297,-8.42297 z M 357.33122,229.12838 257.81354,143.85288 h 61.09465 l 165.91045,142.23669 h -61.09465 z m -13.14869,-85.2755 h 57.04394 l 165.9255,142.23669 h -57.04395 z m 301.1547,142.23669 h -52.918 L 426.49373,143.85288 h 52.83524 z M 243.74245,419.48 h 60.2475 l -60.2475,111.4787 z M 226.89109,530.96472 167.06041,419.48 h 60.24749 z m -65.39062,-87.13233 60.24749,111.39595 h -60.24749 z m 87.88468,111.39595 60.2475,-111.39595 v 111.39595 z m 76.68205,0 V 411.2221 c 0,-2.23948 -0.88754,-4.37904 -2.46864,-5.96005 -1.58116,-1.58116 -3.72073,-2.46864 -5.96005,-2.46864 H 153.24783 c -4.65531,0 -8.42884,3.77354 -8.42884,8.42884 V 555.22849 H 99.736065 V 262.83126 L 235.57167,146.63225 371.32,262.83126 v 292.39723 z',
            },

            // Star shape
            'star': {
                shapeId: 'star',
                symbolViewBox: '0 0 700 700',
                transform: 'translate(-6%, 2%) scale(3)',
                hasFrame: true,
                symbolPath: 'm 208.66614,878.30743 c -14.15748,-5.44372 -24.84712,-20.8797 -24.77423,-35.77432 0.0205,-4.19187 8.51693,-57.05342 18.88092,-117.47012 12.16762,-70.93091 18.84362,-113.22226 18.84362,-119.37115 0,-12.0254 -3.70493,-24.26563 -10.49534,-34.67413 -3.50087,-5.36624 -31.90959,-33.96172 -87.68968,-88.2662 -59.923725,-58.3385 -83.529942,-82.16559 -86.232869,-87.0397 -3.209996,-5.78848 -3.718196,-8.18436 -3.695867,-17.42391 0.02173,-8.99389 0.602363,-11.81325 3.619066,-17.57311 4.78554,-9.13714 14.40707,-17.45342 23.019764,-19.89692 3.746648,-1.06295 57.125816,-9.25023 118.620386,-18.19394 72.45366,-10.5376 114.27745,-17.18515 118.8233,-18.88597 10.45906,-3.91324 22.62284,-12.61229 28.47629,-20.36512 2.85518,-3.78167 28.64408,-54.20591 57.30866,-112.05386 47.68128,-96.22555 52.59284,-105.554638 57.70306,-109.602002 15.69885,-12.433727 35.50143,-12.423121 51.22153,0.02744 5.15858,4.085667 9.98209,13.255559 58.71456,111.621282 47.36196,95.5994 53.81447,107.90884 59.76516,114.01394 8.03348,8.24195 15.83757,13.33942 25.52485,16.67233 3.9708,1.36615 38.38197,7.02392 76.46926,12.57279 38.08727,5.54889 89.4516,13.04172 114.14293,16.65076 24.69134,3.60904 47.07098,7.47177 49.73256,8.58384 7.03736,2.94041 15.53445,11.15476 19.58738,18.93562 2.8792,5.52756 3.54038,8.63599 3.57842,16.82338 0.085,18.30969 3.20853,14.65315 -90.36885,105.79203 -55.57736,54.1291 -84.71654,83.45231 -87.81882,88.37346 -7.59144,12.04229 -10.38203,23.35837 -9.52787,38.63643 0.40461,7.23742 8.96922,60.91242 19.47673,122.06211 20.30643,118.17571 19.94593,114.80727 13.61532,127.21632 -8.43143,16.52694 -29.64172,25.47724 -46.38032,19.57151 -2.86721,-1.0116 -46.47955,-23.52835 -96.91632,-50.0372 -126.69569,-66.58947 -116.48153,-61.91285 -135.22307,-61.91285 -18.73467,0 -9.16046,-4.38487 -137.25491,62.86106 -50.0813,26.29125 -93.10522,48.50562 -95.60871,49.36528 -6.71151,2.30461 -17.27503,1.7839 -25.13691,-1.23908 z',
                framePath: 'm 348.7062,19.527591 c -13.5274,0.279559 -26.86394,6.430993 -35.68862,16.718959 -3.68314,4.183704 -6.43459,9.078767 -8.7917,14.103737 -23.9969,48.61646 -47.97137,97.243813 -72.0182,145.833573 -4.8513,8.81672 -14.42169,14.65329 -24.40398,15.40104 -54.33397,7.90582 -108.67594,15.76079 -162.996536,23.75554 -13.630194,2.52679 -26.001768,11.19039 -32.938357,23.20778 -7.0202065,11.91289 -8.8610865,26.85074 -4.5184235,40.02261 2.448838,7.68363 6.8755905,14.70126 12.6793365,20.29324 39.705587,38.71934 79.4237,77.43469 119.10552,116.18132 6.85917,7.33313 9.43309,18.21051 7.05948,27.91212 -9.27366,54.14987 -18.59056,108.29283 -27.7876,162.45544 -0.60297,4.85564 -0.45926,9.87405 0.37965,14.61578 0.28626,1.63866 0.70895,3.49221 1.20737,5.17604 0.85133,2.90221 1.98808,5.7625 3.32911,8.38234 1.67782,3.31897 3.83109,6.54469 6.18743,9.31067 0.58855,0.70104 1.2219,1.38987 1.83505,2.04405 4.56587,4.84552 10.11855,8.74927 16.21023,11.43243 0.74307,0.31265 1.77298,0.75464 2.64949,1.07162 12.48626,4.70417 26.91005,3.90269 38.79776,-2.15791 6.88108,-3.53016 13.69971,-7.18275 20.55538,-10.76353 42.66533,-22.42845 85.33179,-44.85639 128.01973,-67.24077 9.06883,-4.20161 20.14693,-3.28923 28.61436,1.92405 48.65609,25.56584 97.28663,51.18176 145.98648,76.6634 2.17213,1.02896 4.46508,1.88442 6.68084,2.54829 3.1503,0.93381 6.41065,1.56746 9.61101,1.84999 2.49154,0.23675 5.1396,0.27952 7.46516,0.12162 13.84724,-0.82171 27.11506,-7.9325 35.63155,-18.8544 6.84299,-8.59156 10.50665,-19.5883 10.37565,-30.55642 0.0233,-3.9666 -0.66462,-7.88179 -1.37366,-11.76956 -9.14811,-53.41097 -18.30695,-106.8207 -27.4042,-160.23992 -1.32514,-9.90763 2.90967,-20.20858 10.44467,-26.68781 39.43964,-38.46449 78.92046,-76.88793 118.29491,-115.41851 5.85862,-6.28466 9.99512,-14.14982 11.89343,-22.52783 0.44965,-1.95766 0.79858,-4.16038 0.98164,-6.24516 1.1958,-12.87827 -2.95625,-26.13231 -11.23569,-36.06165 -4.40807,-5.31243 -9.95054,-9.69856 -16.19103,-12.66293 -5.24425,-2.55834 -11.10793,-4.10675 -16.95011,-4.7987 -52.56649,-7.61798 -105.12832,-15.26916 -157.69192,-22.90601 -4.6409,-0.60138 -9.37259,-1.51792 -13.42804,-3.97865 -6.10447,-3.43076 -10.86394,-9.04416 -13.53994,-15.49004 -24.26079,-49.13931 -48.4812,-98.299103 -72.80814,-147.405132 -6.62006,-12.12843 -18.6205,-21.215731 -32.15633,-24.09619 -3.95845,-0.873351 -8.0211,-1.251625 -12.07276,-1.164517 z',
            },

            // Shield shape
            'shield': {
                shapeId: 'shield',
                symbolViewBox: '0 0 948.83423 1162.0956',
                transform: 'translate(-6%, -25%) scale(2.7)',
                hasFrame: true,
                symbolPath: 'm 500.57422,9.5410156 c -48.72514,0.1961863 -97.44195,2.9101414 -145.88241,8.1715634 -33.83615,3.691624 -67.55203,8.634426 -100.92023,15.376557 -24.16912,4.912693 -48.18093,10.757259 -71.6447,18.391062 -13.39113,4.361914 -26.55514,9.447132 -39.2841,15.483446 -7.44294,3.506167 -14.88716,7.167546 -21.53809,12.055887 -4.86657,3.606373 -9.19418,8.28087 -11.22364,14.083524 -2.28721,6.469878 -2.12197,13.484575 -1.35774,20.212105 1.91895,18.10833 4.38649,36.15236 6.78012,54.20239 6.70081,49.7395 13.84657,99.41688 21.12101,149.07572 4.97155,34.00918 10.16918,67.98521 14.98007,102.01779 8.52104,60.19127 16.59006,120.46414 24.47166,180.75027 7.64583,58.87765 15.1313,117.80316 22.17225,176.76124 2.98714,24.98199 5.83115,49.98071 8.55743,74.99249 2.68706,24.42852 5.50359,48.84356 8.45834,73.24074 2.42206,19.80209 4.88771,39.60121 7.73035,59.34762 0.8715,5.6589 1.64172,11.34146 2.83388,16.94408 1.27544,5.2485 3.39863,10.2965 6.23799,14.8916 4.89543,7.8645 12.15408,13.8974 19.70819,19.0951 11.34306,7.74 23.53045,14.1147 35.55729,20.7032 30.84113,16.6684 61.85185,33.0218 92.90665,49.2888 19.6416,10.2626 39.29037,20.5148 59.08633,30.4776 6.12903,3.0624 12.32655,6.0239 18.76623,8.3806 4.79903,1.7226 9.92285,2.7608 15.03665,2.2967 6.64156,-0.5046 12.96647,-2.8284 19.10218,-5.2794 10.29927,-4.2886 20.27895,-9.2944 30.26598,-14.2537 32.60464,-16.4079 65.13012,-32.9734 97.52087,-49.8002 19.28733,-10.0568 38.58026,-20.1101 57.6162,-30.6371 9.11142,-5.0986 18.40301,-10.1432 26.21239,-17.1647 4.6044,-4.1545 8.40102,-9.2105 10.95899,-14.8684 3.60811,-7.8588 5.37217,-16.39195 6.95631,-24.84566 1.54055,-8.71617 2.54934,-17.5144 3.74384,-26.28176 7.25687,-55.96544 13.70881,-112.03477 20.49343,-168.05508 9.95246,-82.57339 20.29108,-165.10495 31.38349,-247.52645 13.01066,-96.8828 26.86307,-193.63544 40.85113,-290.38206 6.59496,-45.5828 13.26068,-91.15547 19.87664,-136.73514 1.17345,-9.59701 1.71044,-19.26887 1.63284,-28.936563 -0.0184,-2.851121 0.0704,-5.714548 -0.0233,-8.557865 -0.2593,-1.200836 -0.99469,-2.283304 -2.04464,-2.933962 C 832.29353,75.201123 827.07566,70.637516 821.21599,66.958165 810.5845,60.12345 799.00606,54.90907 787.26248,50.307303 767.93196,42.838108 747.92968,37.243523 727.77242,32.50435 698.74774,25.745933 669.29532,20.937377 639.72096,17.340619 597.3964,12.240614 554.77005,9.7706325 512.14422,9.558375 c -3.85661,-0.024746 -7.71333,-0.024674 -11.57,-0.017359 z',
                framePath: 'M 599.95745,7.0974723 C 728.59621,20.705616 804.92893,40.905048 836.61021,69.609675 l 9.99343,9.142818 -0.42525,20.83736 C 845.96577,111.2843 843.8395,133.61 841.50062,149.3444 c -2.55153,15.73433 -6.37878,42.09995 -8.71768,58.47218 -2.33888,16.37219 -5.10302,35.93378 -6.16616,43.58834 -8.71766,56.77112 -17.64795,119.70846 -23.38885,162.65889 -1.27576,9.35552 -5.31566,37.63479 -8.71767,62.72466 -9.99342,71.8676 -10.20605,73.99389 -13.82069,100.99739 -1.701,14.03333 -4.25251,32.10653 -5.31566,40.39894 -1.06312,8.07977 -3.40201,27.21615 -5.31564,42.52521 -1.701,15.09644 -4.03989,34.23279 -5.31564,42.52519 -1.06314,8.0798 -4.03991,31.04341 -6.3788,51.03025 -2.33887,19.77423 -5.31564,43.80097 -6.37877,53.15652 -1.06313,9.35555 -3.61465,29.98027 -5.31564,45.7146 -1.91365,15.73432 -4.25254,35.9338 -5.31566,44.65146 -1.27576,8.71766 -4.03989,33.59491 -6.59141,55.28276 -5.95353,55.07011 -8.9303,65.48881 -23.17624,80.37261 -11.05656,11.4819 -25.3025,19.349 -150.53922,82.7115 l -72.93073,36.7844 -13.4992,3.4268 c -28.95801,-3.9613 -19.45783,-3.8521 -46.46136,-17.4601 -26.36562,-13.1829 -40.82421,-20.8374 -66.33934,-34.8708 -5.95348,-3.1893 -22.11309,-11.907 -36.14639,-19.1363 -14.03333,-7.4419 -26.57825,-14.0333 -27.64138,-14.8838 -1.27575,-0.8505 -10.84391,-6.1662 -21.2626,-11.6944 -51.03027,-27.2162 -57.40901,-36.5717 -63.57519,-93.55547 -0.63785,-5.95353 -2.76414,-23.17623 -4.46516,-38.27269 -1.9136,-15.30908 -4.67773,-40.61157 -6.37876,-56.34589 -5.10305,-47.20298 -9.35559,-82.92415 -17.01008,-145.64884 -1.91366,-15.30907 -4.25253,-35.29591 -5.31565,-44.65146 -2.12628,-18.49849 -9.14295,-72.7181 -12.75756,-99.93425 -1.27574,-9.35552 -3.18941,-25.08986 -4.46515,-35.08328 -1.06312,-9.78081 -2.55149,-19.77423 -2.97677,-22.32573 -0.63791,-2.33887 -1.91366,-12.3323 -3.18941,-22.32573 -2.12624,-18.49847 -8.29242,-63.57519 -13.82069,-100.57213 -1.701,-11.2692 -4.67778,-30.40551 -6.37875,-42.52517 -1.91365,-11.90709 -4.25253,-27.42878 -5.31569,-34.44544 -1.06312,-7.01667 -3.40199,-23.38885 -5.31563,-36.14641 -1.91361,-12.97019 -4.67774,-32.53179 -6.37877,-43.58834 C 115.38276,216.32163 106.45244,149.3444 103.47567,123.404 100.4989,98.739343 102.62518,89.383753 112.40598,79.815683 143.44939,50.473223 244.2341,23.894973 383.07887,8.7985943 409.44455,5.8217083 576.78121,4.5460493 599.95745,7.0974723 Z',
            },

            // Watch shape
            'watch': {
                shapeId: 'watch',
                symbolViewBox: '0 0 24 24',
                transform: 'translate(0%, 0%) scale(1)',
                hasFrame: true,
                symbolPath: 'M 11.362984,17.952745 C 10.39359,17.832319 9.4994483,17.505926 8.7116212,16.984907 7.3615796,16.092074 6.4471759,14.724254 6.1221979,13.11149 6.0556181,12.781076 6.0439357,12.61516 6.0439357,12 c 0,-0.616096 0.011634,-0.780849 0.07862,-1.113359 C 6.6139473,8.447427 8.447427,6.6139473 10.886641,6.1225554 11.219151,6.0555696 11.383904,6.0439357 12,6.0439357 c 0.616096,0 0.780849,0.011634 1.113359,0.07862 2.439214,0.4913919 4.272694,2.3248716 4.764086,4.7640853 0.06698,0.33251 0.07862,0.497263 0.07862,1.113359 0,0.616096 -0.01163,0.780849 -0.07862,1.113359 -0.490312,2.433852 -2.314287,4.262727 -4.74811,4.760864 -0.247426,0.05064 -0.51179,0.07231 -0.991602,0.08127 -0.359828,0.0067 -0.708465,0.0055 -0.774749,-0.0028 z',
                framePath: 'M6,12A6,6 0 0,1 12,6A6,6 0 0,1 18,12A6,6 0 0,1 12,18A6,6 0 0,1 6,12M20,12C20,9.45 18.81,7.19 16.95,5.73L16,0H8L7.05,5.73C5.19,7.19 4,9.45 4,12C4,14.54 5.19,16.81 7.05,18.27L8,24H16L16.95,18.27C18.81,16.81 20,14.54 20,12Z',
            },

            // Simple shapes without frames (icon-only)
            'home': {
                shapeId: 'home',
                symbolViewBox: '0 0 24 24',
                transform: 'translate(0%, 10%)',
                hasFrame: false,
                symbolPath: 'M19 20V12H22L12 3L2 12H5V20z',
            },

            'circle': {
                shapeId: 'circle',
                symbolViewBox: '0 0 200 200',
                transform: 'translate(-8%, -6.5%) scale(1.3)',
                hasFrame: false,
                symbolPath: 'M100 5 a95 95 0 1 0 190 0 a95 95 0 1 0 -190 0Z',
            },

            'umbrella': {
                shapeId: 'umbrella',
                symbolViewBox: '0 0 24 24',
                transform: 'translate(-3%, -26%) scale(2.6)',
                hasFrame: false,
                symbolPath: 'M12,2A9,9 0 0,1 21,11H13V19A3,3 0 0,1 10,22A3,3 0 0,1 7,19V18H9V19A1,1 0 0,0 10,20A1,1 0 0,0 11,19V11H3A9,9 0 0,1 12,2Z',
            },

            'van': {
                shapeId: 'van',
                symbolViewBox: '0 0 24 24',
                transform: 'translate(-4%, 9%) scale(1.8)',
                hasFrame: false,
                symbolPath: 'M3,7C1.89,7 1,7.89 1,9V17H3A3,3 0 0,0 6,20A3,3 0 0,0 9,17H15A3,3 0 0,0 18,20A3,3 0 0,0 21,17H23V13C23,11.89 22.11,11 21,11L18,7H3M3,8.5H7V11H3V8.5zM9,8.5H13V11H9V8.5zM15,8.5H17.5L19.46,11H15V8.5zM6,15.5A1.5,1.5 0 0,1 7.5,17A1.5,1.5 0 0,1 6,18.5A1.5,1.5 0 0,1 4.5,17A1.5,1.5 0 0,1 6,15.5M18,15.5A1.5,1.5 0 0,1 19.5,17A1.5,1.5 0 0,1 18,18.5A1.5,1.5 0 0,1 16.5,17A1.5,1.5 0 0,1 18,15.5Z',
            },

            'water': {
                shapeId: 'water',
                symbolViewBox: '0 0 24 24',
                transform: 'translate(0%, 7%)',
                hasFrame: false,
                symbolPath: 'M12,20A6,6 0 0,1 6,14C6,10 12,3.25 12,3.25C12,3.25 18,10 18,14A6,6 0 0,1 12,20Z',
            },

            // More shapes with frames...
            'electrician': {
                shapeId: 'electrician',
                symbolViewBox: '0 0 700 700',
                transform: 'translate(-30.5%, -18.3%) scale(3.4)',
                hasFrame: true,
                framePath: 'm 562.96779,199.24472 -102.48,173.88 83.969,-0.66016 c 15.39845,-0.12112 27.98169,12.29588 28.10231,27.69434 l 0.21094,26.6836 c 0.0603,7.64905 -2.97089,14.99693 -8.42578,20.42773 -5.45491,5.43081 -12.81636,8.4288 -20.46485,8.33399 l -84.21875,1.01953 -128.72266,169.77149 c -4.34652,5.73336 -10.3168,10.18413 -17.16015,12.79101 -12.6846,4.83205 -26.98754,2.27697 -37.3711,-6.67578 -10.38355,-8.95275 -15.26047,-22.69174 -12.73242,-35.88867 l 21.78125,-113.53906 -89.00586,-0.77735 c -15.39846,-0.13438 -27.83399,-12.69232 -27.69922,-28.09179 l 0.19336,-22.33594 c 0.13475,-15.39846 12.69233,-27.83297 28.08984,-27.69824 l 76.68164,-0.16015 56.97852,-116.53321 -42.9375,0.006 c -7.64977,0.0111 -14.98706,-2.97141 -20.41992,-8.29297 -5.43287,-5.32155 -8.52008,-12.58426 -8.57227,-20.23437 v -38.08008 c -0.0477,-7.68621 2.8895,-15.07762 8.16797,-20.5625 5.27847,-5.48489 12.54943,-8.69774 20.23242,-8.9336 l 88.91211,-2.89453 0.12305,-14.63672 c 0.22652,-27.02149 22.35656,-48.75395 49.38086,-48.52734 27.02395,0.22659 48.75396,22.35556 48.52734,49.37695 l 0.0371,14.66602 101.63672,-4.01172 c 7.7251,-0.30462 15.21256,2.54756 20.80078,7.92578 5.58822,5.37822 8.85628,12.80411 9.08399,20.63672 l 0.92969,31.97656 c 0.0501,1.72293 -0.0361,3.44683 -0.25781,5.15234 -1.43188,15.35938 -14.37008,27.01657 -29.72657,26.78321 -1.59313,-0.024 -3.18212,-0.16588 -4.75195,-0.42188 l -40.1543,-1.11523 z',
            },

            'food': {
                shapeId: 'food',
                symbolViewBox: '0 0 700 700',
                transform: 'translate(1%, 1%) scale(1.9)',
                hasFrame: true,
                framePath: 'm 106.95023,105.65714 1.23,0.6 c 1.53,0.72 3.12,1.35 4.74,1.83 l 0.12,0.06 0.12,0.03 c 13.19001,4.44 27.78001,2.16 38.88001,-6.27 7.74,-5.85 13.08,-14.16 14.97,-23.19 0.81,-3.75 1.05,-7.62 0.75,-11.43 -1.2,-15.24 -11.67,-28.5 -26.19001,-33.18 -14.52,-4.68 -30.81,0.27 -40.80001,12.39 -3.63,4.38 -6.3,9.54 -7.74,15.03 -3.93001,14.73 0.72,30.6 12.09001,40.86 0.54,0.51 1.11,0.99 1.68,1.47 z m 9.66,6.39 c -6.42,-1.02 -12.51,-3.48 -17.82001,-7.14 -5.88,-4.05 -10.68,-9.48 -13.95,-15.81 -3.27,-6.27 -5.04,-13.35 -5.13,-20.49 -0.09,-7.17 1.53,-14.37 4.74,-20.88 3.15,-6.45 7.83,-12.21 13.65001,-16.59 5.76,-4.35 12.57,-7.29 19.71001,-8.49 1.11,-0.18 2.22,-0.33 3.33,-0.42 2.91,-0.27 5.88,-0.21 8.76,0.12 7.14,0.81 14.04,3.3 20.04,7.23 6.03,3.93 11.1,9.33 14.76,15.63 3.63,6.27 5.82,13.41 6.36,20.67 0.21,2.82 0.18,5.64 -0.06,8.46 -0.75,8.64 -3.93,17.01 -9.15,23.91 -5.19,6.87 -12.42,12.27 -20.64,15.27 -7.20001,2.64 -15.03001,3.27 -22.62001,1.83 -0.66001,-0.12 -1.32001,-0.24 -1.98001,-0.36 z',
            },

            'furniture': {
                shapeId: 'furniture',
                symbolViewBox: '0 0 700 700',
                transform: 'translate(-4%, -20.5%) scale(2.5)',
                hasFrame: true,
            },

            'golf': {
                shapeId: 'golf',
                symbolViewBox: '0 0 700 700',
                transform: 'translate(-7.5%, -18%) scale(3)',
                hasFrame: true,
            },

            'gym': {
                shapeId: 'gym',
                symbolViewBox: '0 0 700 700',
                transform: 'translate(-9.35%, -31.8%) scale(3.125)',
                hasFrame: true,
            },

            'ice-cream': {
                shapeId: 'ice-cream',
                symbolViewBox: '0 0 700 700',
                transform: 'translate(16%, -4%) scale(1.3)',
                hasFrame: true,
            },

            'locksmith': {
                shapeId: 'locksmith',
                symbolViewBox: '0 0 700 700',
                transform: 'translate(-18.5%, 9%) scale(3)',
                hasFrame: true,
            },

            'mobile': {
                shapeId: 'mobile',
                symbolViewBox: '0 0 700 700',
                transform: 'translate(-2.5%, -2.5%) scale(2.3)',
                hasFrame: true,
            },

            'pest': {
                shapeId: 'pest',
                symbolViewBox: '0 0 700 700',
                transform: 'translate(-17.5%, 21%) scale(1.9)',
                hasFrame: true,
            },

            'pet': {
                shapeId: 'pet',
                symbolViewBox: '0 0 700 700',
                transform: 'translate(2%, 25%) scale(1.7)',
                hasFrame: true,
            },

            'piggy-bank': {
                shapeId: 'piggy-bank',
                symbolViewBox: '0 0 491.98447 439.45703',
                transform: 'translate(-8%, -2%) scale(4)',
                hasFrame: true,
            },

            'plumber': {
                shapeId: 'plumber',
                symbolViewBox: '0 0 700 700',
                transform: 'translate(-2%, 18.5%) scale(2.2)',
                hasFrame: true,
            },

            'realtor': {
                shapeId: 'realtor',
                symbolViewBox: '0 0 700 700',
                transform: 'translate(-5%, -3%) scale(1.9)',
                hasFrame: true,
            },

            'realtor-sign': {
                shapeId: 'realtor-sign',
                symbolViewBox: '0 0 41.084998 44.199886',
                transform: 'translate(-19%, -9.5%) scale(3)',
                hasFrame: true,
            },

            'restaurant': {
                shapeId: 'restaurant',
                symbolViewBox: '0 0 700 700',
                transform: 'translate(-8.5%, 18%) scale(1.84)',
                hasFrame: true,
            },

            'salon': {
                shapeId: 'salon',
                symbolViewBox: '0 0 700 700',
                transform: 'translate(2%, -6%) scale(1.6)',
                hasFrame: true,
            },

            'search': {
                shapeId: 'search',
                symbolViewBox: '0 0 700 700',
                transform: 'translate(-8%, -7%) scale(1.45)',
                hasFrame: true,
            },

            'sun-rise': {
                shapeId: 'sun-rise',
                symbolViewBox: '0 0 700 700',
                transform: 'translate(5%, 2%) scale(1.5)',
                hasFrame: true,
            },

            'water-glass': {
                shapeId: 'water-glass',
                symbolViewBox: '0 0 700 700',
                transform: 'translate(-2%, -15%) scale(2.15)',
                hasFrame: true,
            },

            'boot': {
                shapeId: 'boot',
                symbolViewBox: '0 0 948.83423 1162.0956',
                transform: 'translate(-8%, 2%) scale(1.4)',
                hasFrame: true,
            },

            'book': {
                shapeId: 'book',
                symbolViewBox: '0 0 700 700',
                transform: 'translate(-1%, -14%) scale(1.3)',
                hasFrame: true,
            },

            // Simple icon shapes (no frame)
            'message': {
                shapeId: 'message',
                symbolViewBox: '0 0 24 24',
                transform: 'translate(0%, 0%) scale(1)',
                hasFrame: false,
                symbolPath: 'M20,2H4A2,2 0 0,0 2,4V22L6,18H20A2,2 0 0,0 22,16V4A2,2 0 0,0 20,2Z',
            },

            'sun': {
                shapeId: 'sun',
                symbolViewBox: '0 0 24 24',
                transform: 'translate(0%, 0%) scale(1)',
                hasFrame: false,
                symbolPath: 'M12,7A5,5 0 0,1 17,12A5,5 0 0,1 12,17A5,5 0 0,1 7,12A5,5 0 0,1 12,7M12,9A3,3 0 0,0 9,12A3,3 0 0,0 12,15A3,3 0 0,0 15,12A3,3 0 0,0 12,9M12,2L14.39,5.42C13.65,5.15 12.84,5 12,5C11.16,5 10.35,5.15 9.61,5.42L12,2M3.34,7L7.5,6.65C6.9,7.16 6.36,7.78 5.94,8.5C5.5,9.24 5.25,10 5.11,10.79L3.34,7M3.36,17L5.12,13.23C5.26,14 5.53,14.78 5.95,15.5C6.37,16.24 6.91,16.86 7.5,17.37L3.36,17M20.65,7L18.88,10.79C18.74,10 18.47,9.23 18.05,8.5C17.63,7.78 17.1,7.15 16.5,6.64L20.65,7M20.64,17L16.5,17.36C17.09,16.85 17.62,16.22 18.04,15.5C18.46,14.77 18.73,14 18.87,13.21L20.64,17M12,22L9.59,18.56C10.33,18.83 11.14,19 12,19C12.82,19 13.63,18.83 14.37,18.56L12,22Z',
            },

            'travel': {
                shapeId: 'travel',
                symbolViewBox: '0 0 700 700',
                transform: 'translate(-12%, -6.5%) scale(1.9)',
                hasFrame: false,
                symbolPath: 'm 338.69433,509.77549 -0.70036,0.70036 c -18.25402,11.23514 -37.21267,21.76465 -56.87094,30.1889 -19.65953,8.42401 -40.02368,14.74715 -60.38282,18.95865 -20.35914,4.212 -42.13006,5.61764 -62.4892,3.51163 -20.35915,-2.10599 -40.7233,-7.02326 -58.977313,-16.14763 -17.55315,-9.12914 -33.700788,-22.47053 -43.530551,-40.02368 -9.829516,-16.85228 -15.446774,-37.21267 -14.041261,-57.57683 1.405626,-20.35914 7.723634,-41.42417 17.55314,-60.38282 9.829516,-18.95865 23.17016,-37.21267 37.912296,-53.36031 2.806366,-2.80637 2.806366,-7.72364 0,-10.52988 -2.806377,-2.80638 -7.723644,-2.80638 -10.529887,0 -16.852276,16.14763 -32.300294,34.40541 -44.235179,54.76581 -12.63576,20.35915 -21.76465,43.53055 -24.576914,68.10621 -3.511633,24.57691 1.40563,51.25393 13.341644,73.72447 11.935517,23.17015 30.894786,41.42417 52.659434,54.76581 21.764651,13.34164 46.341561,21.06503 70.212591,25.27653 24.57691,3.51163 49.14755,3.51163 73.72447,0.70036 24.5769,-2.80637 47.74205,-9.12914 70.91345,-16.85228 23.17015,-7.72363 44.93605,-18.25401 66.00108,-29.48928 0.70036,0 0.70036,-0.70036 1.40563,-0.70036 11.93551,-7.72363 16.14765,-23.17015 8.42401,-35.10629 -7.72364,-14.03625 -23.17016,-18.25402 -35.81093,-10.52988 z',
            },

            'home-mover': {
                shapeId: 'home-mover',
                symbolViewBox: '0 0 24 24',
                transform: 'translate(0%, 0%) scale(1)',
                hasFrame: false,
            },

            'juice': {
                shapeId: 'juice',
                symbolViewBox: '0 0 24 24',
                transform: 'translate(0%, 0%) scale(1)',
                hasFrame: false,
            },

            'legal': {
                shapeId: 'legal',
                symbolViewBox: '0 0 24 24',
                transform: 'translate(0%, 0%) scale(1)',
                hasFrame: false,
            },

            'painter': {
                shapeId: 'painter',
                symbolViewBox: '0 0 24 24',
                transform: 'translate(0%, 0%) scale(1)',
                hasFrame: false,
            },

            'shawarma': {
                shapeId: 'shawarma',
                symbolViewBox: '0 0 24 24',
                transform: 'translate(0%, 0%) scale(1)',
                hasFrame: false,
            },

            't-shirt': {
                shapeId: 't-shirt',
                symbolViewBox: '0 0 24 24',
                transform: 'translate(0%, 0%) scale(1)',
                hasFrame: false,
            },

            'shopping-cart': {
                shapeId: 'shopping-cart',
                symbolViewBox: '0 0 24 24',
                transform: 'translate(0%, 0%) scale(1)',
                hasFrame: false,
            },

            'gardening': {
                shapeId: 'gardening',
                symbolViewBox: '0 0 700 700',
                transform: 'translate(-5%, 34%) scale(1.7)',
                hasFrame: true,
                isMultiplePath: true, // Uses multiple paths
            },

            // Additional shapes - simplified entries
            'brain': { shapeId: 'brain', hasFrame: false },
            'builder': { shapeId: 'builder', hasFrame: false },
            'bulb': { shapeId: 'bulb', hasFrame: false },
            'burger': { shapeId: 'burger', hasFrame: false },
            'car': { shapeId: 'car', hasFrame: false },
            'cloud': { shapeId: 'cloud', hasFrame: false },
            'cooking': { shapeId: 'cooking', hasFrame: false },
            'cup': { shapeId: 'cup', hasFrame: false },
            'dentist': { shapeId: 'dentist', hasFrame: false },
            'gift': { shapeId: 'gift', hasFrame: false },
            'pizza': { shapeId: 'pizza', hasFrame: false },
            'teddy': { shapeId: 'teddy', hasFrame: false },
            'trophy': { shapeId: 'trophy', hasFrame: false },
            'truck': { shapeId: 'truck', hasFrame: false },
        };
    }

    /**
     * Check if this processor should process the payload
     * @param {Object} payload
     * @returns {boolean}
     */
    shouldProcess(payload) {
        const { design } = payload;
        // Check advancedShape (stickers), shape (outlined shapes like apple, bag), and frame
        // Note: 'none' is truthy but means "no shape", so we need to check for it explicitly
        const advancedShape = design.advancedShape && design.advancedShape !== 'none' ? design.advancedShape : null;
        const outlinedShape = design.shape && design.shape !== 'none' ? design.shape : null;
        const frameShape = design.frame && design.frame !== 'none' ? design.frame : null;
        const shape = advancedShape || outlinedShape || frameShape || 'none';
        const hasFrame = shape !== 'none' && !!this.frames[shape];
        this.log(`shouldProcess: resolved='${shape}', advancedShape='${design.advancedShape}', shape='${design.shape}', frame='${design.frame}', hasFrame=${hasFrame}`);
        return hasFrame;
    }

    /**
     * Process the payload to prepare frame data
     * @param {Object} payload
     * @returns {Promise<Object>}
     */
    async process(payload) {
        const { design, size } = payload;

        // Check advancedShape (stickers), shape (outlined shapes like apple, bag), and frame
        // Note: 'none' is truthy but means "no shape", so we need to check for it explicitly
        const advancedShape = design.advancedShape && design.advancedShape !== 'none' ? design.advancedShape : null;
        const outlinedShape = design.shape && design.shape !== 'none' ? design.shape : null;
        const frameShape = design.frame && design.frame !== 'none' ? design.frame : null;
        const frameType = advancedShape || outlinedShape || frameShape || 'none';
        const frameColor = design.advancedShapeFrameColor || design.frameColor || '#000000';
        const textColor = design.advancedShapeTextColor || design.textColor || '#FFFFFF';
        const dropShadow = design.advancedShapeDropShadow || design.dropShadow || false;
        const frameText = design.frameText || this.getDefaultText(frameType);

        // Calculate frame dimensions
        const framePadding = size * 0.1;
        const textHeight = size * 0.08;

        // Check if this is a Laravel shape
        const isLaravelShape = !!this.laravelShapes[frameType];

        payload.frame = {
            type: frameType,
            color: frameColor,
            textColor: textColor,
            dropShadow: dropShadow,
            text: frameText,
            padding: framePadding,
            textHeight: textHeight,
            isLaravelShape: isLaravelShape,
            shapeData: isLaravelShape ? this.laravelShapes[frameType] : null,
        };

        this.log('Frame type: ' + frameType + ', color: ' + frameColor + ', isLaravelShape: ' + isLaravelShape);

        return payload;
    }

    /**
     * Get default text for frame type
     * @param {string} frameType
     * @returns {string}
     */
    getDefaultText(frameType) {
        const defaults = {
            'scan-me': 'SCAN ME',
            'four-corners-text-bottom': 'SCAN HERE',
            'rounded-frame': 'SCAN TO VIEW',
            'banner-bottom': 'SCAN QR CODE',
            'healthcare': 'HEALTH INFO',
            'wifi-connect': 'CONNECT TO WIFI',
            'review-collector': 'LEAVE A REVIEW',
            'social-follow': 'FOLLOW US',
            'ticket': 'SCAN TICKET',
        };
        return defaults[frameType] || 'SCAN ME';
    }

    /**
     * Generate frame SVG elements
     * @param {Object} frameInfo - Frame info from payload
     * @param {number} size - Total SVG size
     * @param {number} qrSize - QR code size (without frame)
     * @returns {Object} - { beforeQR: string, afterQR: string, defs: string }
     */
    generateFrameSVG(frameInfo, size, qrSize) {
        if (!frameInfo || frameInfo.type === 'none') {
            return { beforeQR: '', afterQR: '', defs: '' };
        }

        const generator = this.frames[frameInfo.type];
        if (!generator) {
            return { beforeQR: '', afterQR: '', defs: '' };
        }

        return generator(frameInfo, size, qrSize);
    }

    /**
     * Create Laravel shape frame SVG
     * @param {string} shapeId - Shape identifier
     * @param {Object} frameInfo - Frame information
     * @param {number} size - SVG size
     * @param {number} qrSize - QR code size
     * @returns {Object}
     */
    createLaravelShapeFrame(shapeId, frameInfo, size, qrSize) {
        const shapeData = this.laravelShapes[shapeId];
        if (!shapeData) {
            return { beforeQR: '', afterQR: '', defs: '' };
        }

        const { color, dropShadow } = frameInfo;
        const viewBox = shapeData.symbolViewBox || '0 0 700 700';

        let defs = '';
        if (dropShadow) {
            defs = this.createDropShadowDef('frameShadow');
        }

        let frameContent = '';

        // If the shape has a frame path, render it
        if (shapeData.hasFrame && shapeData.framePath) {
            frameContent = `
                <g class="shape-frame" ${dropShadow ? 'filter="url(#frameShadow)"' : ''}>
                    <path d="${shapeData.framePath}"
                          fill="${color}"
                          stroke="none"/>
                </g>
            `;
        }

        // Create symbol path if available (for masking)
        let symbolContent = '';
        if (shapeData.symbolPath) {
            symbolContent = `
                <defs>
                    <symbol id="symbol-${shapeId}" viewBox="${viewBox}">
                        <path d="${shapeData.symbolPath}"/>
                    </symbol>
                </defs>
            `;
        }

        return {
            beforeQR: symbolContent + frameContent,
            afterQR: '',
            defs: defs,
        };
    }

    // ========================================
    // Basic Frame Generators
    // ========================================

    /**
     * Simple "Scan Me" text below QR
     */
    createScanMeFrame(frameInfo, size, qrSize) {
        const { color, textColor, text, dropShadow } = frameInfo;
        const textY = size - (size * 0.05);
        const fontSize = size * 0.06;

        let defs = '';
        if (dropShadow) {
            defs = this.createDropShadowDef('frameShadow');
        }

        const afterQR = `
            <text x="${size / 2}" y="${textY}"
                  font-family="Arial, sans-serif"
                  font-size="${fontSize}"
                  font-weight="bold"
                  fill="${textColor}"
                  text-anchor="middle"
                  ${dropShadow ? 'filter="url(#frameShadow)"' : ''}>
                ${this.escapeXml(text)}
            </text>
        `;

        return { beforeQR: '', afterQR, defs };
    }

    /**
     * Four corners decorative frame with text at bottom
     */
    createFourCornersFrame(frameInfo, size, qrSize) {
        const { color, textColor, text, dropShadow } = frameInfo;
        const cornerSize = size * 0.08;
        const padding = size * 0.05;
        const textY = size - padding;
        const fontSize = size * 0.05;

        let defs = '';
        if (dropShadow) {
            defs = this.createDropShadowDef('frameShadow');
        }

        const corners = `
            <!-- Top-left corner -->
            <path d="M ${padding} ${padding + cornerSize} L ${padding} ${padding} L ${padding + cornerSize} ${padding}"
                  stroke="${color}" stroke-width="3" fill="none" stroke-linecap="round"/>
            <!-- Top-right corner -->
            <path d="M ${size - padding - cornerSize} ${padding} L ${size - padding} ${padding} L ${size - padding} ${padding + cornerSize}"
                  stroke="${color}" stroke-width="3" fill="none" stroke-linecap="round"/>
            <!-- Bottom-left corner -->
            <path d="M ${padding} ${size - padding - cornerSize - fontSize} L ${padding} ${size - padding - fontSize * 1.5} L ${padding + cornerSize} ${size - padding - fontSize * 1.5}"
                  stroke="${color}" stroke-width="3" fill="none" stroke-linecap="round"/>
            <!-- Bottom-right corner -->
            <path d="M ${size - padding - cornerSize} ${size - padding - fontSize * 1.5} L ${size - padding} ${size - padding - fontSize * 1.5} L ${size - padding} ${size - padding - cornerSize - fontSize}"
                  stroke="${color}" stroke-width="3" fill="none" stroke-linecap="round"/>
        `;

        const textElement = `
            <text x="${size / 2}" y="${textY}"
                  font-family="Arial, sans-serif"
                  font-size="${fontSize}"
                  font-weight="bold"
                  fill="${textColor}"
                  text-anchor="middle">
                ${this.escapeXml(text)}
            </text>
        `;

        return { beforeQR: corners, afterQR: textElement, defs };
    }

    /**
     * Rounded border frame
     */
    createRoundedFrame(frameInfo, size, qrSize) {
        const { color, textColor, text, dropShadow } = frameInfo;
        const padding = size * 0.03;
        const radius = size * 0.05;
        const textY = size - padding * 2;
        const fontSize = size * 0.045;

        let defs = '';
        if (dropShadow) {
            defs = this.createDropShadowDef('frameShadow');
        }

        const frame = `
            <rect x="${padding}" y="${padding}"
                  width="${size - padding * 2}" height="${size - padding * 2 - fontSize * 1.5}"
                  rx="${radius}" ry="${radius}"
                  stroke="${color}" stroke-width="2" fill="none"
                  ${dropShadow ? 'filter="url(#frameShadow)"' : ''}/>
        `;

        const textElement = `
            <text x="${size / 2}" y="${textY}"
                  font-family="Arial, sans-serif"
                  font-size="${fontSize}"
                  font-weight="600"
                  fill="${textColor}"
                  text-anchor="middle">
                ${this.escapeXml(text)}
            </text>
        `;

        return { beforeQR: frame, afterQR: textElement, defs };
    }

    /**
     * Banner at bottom
     */
    createBannerBottomFrame(frameInfo, size, qrSize) {
        const { color, textColor, text, dropShadow } = frameInfo;
        const bannerHeight = size * 0.12;
        const bannerY = size - bannerHeight;
        const fontSize = size * 0.05;

        let defs = '';
        if (dropShadow) {
            defs = this.createDropShadowDef('frameShadow');
        }

        const banner = `
            <rect x="0" y="${bannerY}"
                  width="${size}" height="${bannerHeight}"
                  fill="${color}"
                  ${dropShadow ? 'filter="url(#frameShadow)"' : ''}/>
        `;

        const textElement = `
            <text x="${size / 2}" y="${bannerY + bannerHeight * 0.65}"
                  font-family="Arial, sans-serif"
                  font-size="${fontSize}"
                  font-weight="bold"
                  fill="${textColor}"
                  text-anchor="middle">
                ${this.escapeXml(text)}
            </text>
        `;

        return { beforeQR: '', afterQR: banner + textElement, defs };
    }

    /**
     * Healthcare themed frame with medical cross
     */
    createHealthcareFrame(frameInfo, size, qrSize) {
        const { color, textColor, text, dropShadow } = frameInfo;
        const crossSize = size * 0.08;
        const crossX = size / 2;
        const crossY = size * 0.06;
        const textY = size - size * 0.04;
        const fontSize = size * 0.04;

        let defs = '';
        if (dropShadow) {
            defs = this.createDropShadowDef('frameShadow');
        }

        const cross = `
            <g ${dropShadow ? 'filter="url(#frameShadow)"' : ''}>
                <rect x="${crossX - crossSize * 0.15}" y="${crossY - crossSize * 0.4}"
                      width="${crossSize * 0.3}" height="${crossSize * 0.8}"
                      fill="${color}" rx="2"/>
                <rect x="${crossX - crossSize * 0.4}" y="${crossY - crossSize * 0.15}"
                      width="${crossSize * 0.8}" height="${crossSize * 0.3}"
                      fill="${color}" rx="2"/>
            </g>
        `;

        const textElement = `
            <text x="${size / 2}" y="${textY}"
                  font-family="Arial, sans-serif"
                  font-size="${fontSize}"
                  font-weight="bold"
                  fill="${textColor}"
                  text-anchor="middle">
                ${this.escapeXml(text)}
            </text>
        `;

        return { beforeQR: cross, afterQR: textElement, defs };
    }

    /**
     * WiFi themed frame
     */
    createWifiFrame(frameInfo, size, qrSize) {
        const { color, textColor, text, dropShadow } = frameInfo;
        const iconSize = size * 0.1;
        const iconX = size / 2;
        const iconY = size * 0.08;
        const textY = size - size * 0.04;
        const fontSize = size * 0.04;

        let defs = '';
        if (dropShadow) {
            defs = this.createDropShadowDef('frameShadow');
        }

        const wifiIcon = `
            <g transform="translate(${iconX}, ${iconY})" ${dropShadow ? 'filter="url(#frameShadow)"' : ''}>
                <path d="M 0 ${iconSize * 0.3} A ${iconSize * 0.5} ${iconSize * 0.5} 0 0 1 0 ${-iconSize * 0.2}"
                      stroke="${color}" stroke-width="2.5" fill="none" stroke-linecap="round"/>
                <path d="M 0 ${iconSize * 0.15} A ${iconSize * 0.3} ${iconSize * 0.3} 0 0 1 0 ${-iconSize * 0.05}"
                      stroke="${color}" stroke-width="2.5" fill="none" stroke-linecap="round"/>
                <circle cx="0" cy="${iconSize * 0.35}" r="${iconSize * 0.08}" fill="${color}"/>
            </g>
        `;

        const textElement = `
            <text x="${size / 2}" y="${textY}"
                  font-family="Arial, sans-serif"
                  font-size="${fontSize}"
                  font-weight="bold"
                  fill="${textColor}"
                  text-anchor="middle">
                ${this.escapeXml(text)}
            </text>
        `;

        return { beforeQR: wifiIcon, afterQR: textElement, defs };
    }

    /**
     * Review collector with stars
     */
    createReviewFrame(frameInfo, size, qrSize) {
        const { color, textColor, text, dropShadow } = frameInfo;
        const starSize = size * 0.04;
        const starY = size * 0.06;
        const textY = size - size * 0.04;
        const fontSize = size * 0.04;

        let defs = '';
        if (dropShadow) {
            defs = this.createDropShadowDef('frameShadow');
        }

        let stars = `<g ${dropShadow ? 'filter="url(#frameShadow)"' : ''}>`;
        for (let i = 0; i < 5; i++) {
            const starX = size / 2 + (i - 2) * starSize * 1.5;
            stars += this.createStarPath(starX, starY, starSize, color);
        }
        stars += '</g>';

        const textElement = `
            <text x="${size / 2}" y="${textY}"
                  font-family="Arial, sans-serif"
                  font-size="${fontSize}"
                  font-weight="bold"
                  fill="${textColor}"
                  text-anchor="middle">
                ${this.escapeXml(text)}
            </text>
        `;

        return { beforeQR: stars, afterQR: textElement, defs };
    }

    /**
     * Social media themed frame
     */
    createSocialFrame(frameInfo, size, qrSize) {
        const { color, textColor, text, dropShadow } = frameInfo;
        const iconSize = size * 0.06;
        const textY = size - size * 0.04;
        const fontSize = size * 0.04;

        let defs = '';
        if (dropShadow) {
            defs = this.createDropShadowDef('frameShadow');
        }

        const socialIcon = `
            <text x="${size / 2}" y="${size * 0.08}"
                  font-family="Arial, sans-serif"
                  font-size="${iconSize}"
                  font-weight="bold"
                  fill="${color}"
                  text-anchor="middle"
                  ${dropShadow ? 'filter="url(#frameShadow)"' : ''}>
                @
            </text>
        `;

        const textElement = `
            <text x="${size / 2}" y="${textY}"
                  font-family="Arial, sans-serif"
                  font-size="${fontSize}"
                  font-weight="bold"
                  fill="${textColor}"
                  text-anchor="middle">
                ${this.escapeXml(text)}
            </text>
        `;

        return { beforeQR: socialIcon, afterQR: textElement, defs };
    }

    /**
     * Ticket/coupon style frame
     */
    createTicketFrame(frameInfo, size, qrSize) {
        const { color, textColor, text, dropShadow } = frameInfo;
        const padding = size * 0.02;
        const notchSize = size * 0.03;
        const textY = size - size * 0.04;
        const fontSize = size * 0.04;

        let defs = '';
        if (dropShadow) {
            defs = this.createDropShadowDef('frameShadow');
        }

        const ticketBorder = `
            <path d="
                M ${padding + notchSize} ${padding}
                L ${size - padding - notchSize} ${padding}
                A ${notchSize} ${notchSize} 0 0 0 ${size - padding - notchSize} ${padding + notchSize * 2}
                L ${size - padding - notchSize} ${size - padding - fontSize * 2}
                L ${padding + notchSize} ${size - padding - fontSize * 2}
                L ${padding + notchSize} ${padding + notchSize * 2}
                A ${notchSize} ${notchSize} 0 0 0 ${padding + notchSize} ${padding}
                Z
            " stroke="${color}" stroke-width="2" fill="none" stroke-dasharray="5,3"
            ${dropShadow ? 'filter="url(#frameShadow)"' : ''}/>
        `;

        const textElement = `
            <text x="${size / 2}" y="${textY}"
                  font-family="Arial, sans-serif"
                  font-size="${fontSize}"
                  font-weight="bold"
                  fill="${textColor}"
                  text-anchor="middle">
                ${this.escapeXml(text)}
            </text>
        `;

        return { beforeQR: ticketBorder, afterQR: textElement, defs };
    }

    // ========================================
    // Helper Methods
    // ========================================

    /**
     * Create drop shadow filter definition
     */
    createDropShadowDef(id) {
        return `
            <filter id="${id}" x="-20%" y="-20%" width="140%" height="140%">
                <feDropShadow dx="2" dy="2" stdDeviation="3" flood-color="rgba(0,0,0,0.3)"/>
            </filter>
        `;
    }

    /**
     * Create a star path
     */
    createStarPath(cx, cy, size, fill) {
        const outerR = size;
        const innerR = size * 0.4;
        const points = 5;
        let path = '';

        for (let i = 0; i < points * 2; i++) {
            const r = i % 2 === 0 ? outerR : innerR;
            const angle = (i * Math.PI / points) - Math.PI / 2;
            const x = cx + r * Math.cos(angle);
            const y = cy + r * Math.sin(angle);

            if (i === 0) {
                path = 'M ' + x + ' ' + y;
            } else {
                path += ' L ' + x + ' ' + y;
            }
        }
        path += ' Z';

        return '<path d="' + path + '" fill="' + fill + '"/>';
    }

    /**
     * Escape XML special characters
     */
    escapeXml(text) {
        if (!text) return '';
        return text
            .replace(/&/g, '&amp;')
            .replace(/</g, '&lt;')
            .replace(/>/g, '&gt;')
            .replace(/"/g, '&quot;')
            .replace(/'/g, '&apos;');
    }

    /**
     * Get list of supported frame types (basic frames)
     */
    static getSupportedBasicFrames() {
        return [
            'none',
            'scan-me',
            'four-corners-text-bottom',
            'rounded-frame',
            'banner-bottom',
            'healthcare',
            'wifi-connect',
            'review-collector',
            'social-follow',
            'ticket',
        ];
    }

    /**
     * Get list of all Laravel shapes
     */
    static getSupportedLaravelShapes() {
        return [
            'apple', 'bag', 'bakery', 'barn', 'book', 'boot', 'brain', 'builder',
            'bulb', 'burger', 'car', 'circle', 'cloud', 'cooking', 'cup', 'dentist',
            'electrician', 'food', 'furniture', 'gardening', 'gift', 'golf', 'gym',
            'home', 'home-mover', 'ice-cream', 'juice', 'legal', 'locksmith',
            'message', 'mobile', 'painter', 'pest', 'pet', 'piggy-bank', 'pizza',
            'plumber', 'realtor', 'realtor-sign', 'restaurant', 'salon', 'search',
            'shawarma', 'shield', 'shopping-cart', 'star', 'sun', 'sun-rise',
            't-shirt', 'teddy', 'travel', 'trophy', 'truck', 'umbrella', 'van',
            'watch', 'water', 'water-glass',
        ];
    }

    /**
     * Get list of all supported frame types
     */
    static getSupportedFrames() {
        return [
            ...FrameProcessor.getSupportedBasicFrames(),
            ...FrameProcessor.getSupportedLaravelShapes(),
        ];
    }

    /**
     * Check if a shape has a frame border
     * @param {string} shapeId
     * @returns {boolean}
     */
    hasFrameBorder(shapeId) {
        const shape = this.laravelShapes[shapeId];
        return shape ? shape.hasFrame === true : false;
    }

    /**
     * Get shape data by ID
     * @param {string} shapeId
     * @returns {Object|null}
     */
    getShapeData(shapeId) {
        return this.laravelShapes[shapeId] || null;
    }
}

module.exports = FrameProcessor;
